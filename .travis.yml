language: generic

addons:
  apt:
    packages:
    - zip

script:
- mkdir -p upload/infrastructure
- mkdir -p upload/lambdas
- zip -r9 upload/infrastructure/cloudformationtemplate.zip auth db etl lambdas network web buildspec.yml main.yaml
- zip -r9 upload/lambdas/sqslambda.zip lambdas/sqslambda
- zip -r9 upload/lambdas/apilambda.zip lambdas/apilambda

deploy:
  - provider: s3
    access_key_id: $AWS_KEY
    secret_access_key: $AWS_SECRET_KEY
    bucket: "app-sourcecodebucket-us-east-1"
    region: us-east-1
    upload-dir: upload/infrastructure
    local-dir: infrastructure
    skip_cleanup: true
  - provider: s3
    access_key_id: $AWS_KEY
    secret_access_key: $AWS_SECRET_KEY
    bucket: "app-sourcecodebucket-us-east-1"
    region: us-east-1
    upload-dir: upload/lambdas
    local-dir: lambdas
    skip_cleanup: true